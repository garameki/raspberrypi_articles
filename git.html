<html lang='ja'>
<head>
<meta charset="utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><link rel="stylesheet" type="text/css" href="style.css" /><script type="application/javascript" src="script.js"></script>
<meta name="description" content="Gitから、GitHubにPUSHできるようにする">
<title>Gitから、GitHubにPUSHできるようにする|がらめきドットコム</title>
</head><body id="body">
<h1>Gitから、GitHubにPUSHできるようにする</h1>
<div class="pp">
<ul>
<li><a href="https://git-scm.com/book/ja/v1/Git-%E3%81%AE%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%9E%E3%82%A4%E3%82%BA-Git-%E3%81%AE%E8%A8%AD%E5%AE%9A">Git</a>
<li><a href="http://vdeep.net/github#SSH">参考 GitHubの登録手順</a>
<li><a href="http://soramugi.hateblo.jp/entry/2012/02/12/234946">参考 GitHubに登録して複数のPCからpushできるように設定する方法まとめ</a>
</ul>
Gitは最初から入っている。<br>
SSH使わなくても、アカウントとパスワードがあれば、pushできるが、毎回ユーザー名とパスワードを聞かれてうざいのでSSHを登録することにする。<br>
鍵を生成したときに入力したパスワードを、git push --set-upstream origin masterするとき聞かれるから、忘れない。
</div>
<h2>やったこと</h2>
<div class="pp">
<pre>
$ <span class="spanCaution">mkdir ~/git</span>
$ <span class="spanCaution">cd ~/git</span>
$ <span class="spanCaution">echo</span> <span style="color:skyblue;">githubにmax31856リポジトリを作成して、</span><span style="background-color:lightgreen;color:white;">clone or download</span><span style="color:skyblue;">からURLをクリップ</span>
$ <span class="spanCaution">git clone https://github.com/garameki/max31856.git</span>
loning into 'max31856'...
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (4/4), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 4 (delta 0), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (4/4), done.
$ <span class="spanCaution">cd max31856</span>
$ <span class="spanCaution">echo test &gt; max31856.py</span>
$ <span class="spanCaution">git add max31856.py</span>
$ <span class="spanCaution">git commit -m 'First commit'</span>

*** Please tell me who you are.

Run

  git config --global user.email "you@example.com"
  git config --global user.name "Your Name"
to set your account's default identity.
Omit --global to set the identity only in this repository.

fatal: empty ident name (for <(null)>) not allowed
$ <span class="spanCaution">git config --global user.email "---------------@gmail.com"</span>
$ <span class="spanCaution">git config --global user.name "garameki"</span>
$ <span class="spanCaution">git commit -m 'First commit'</span>
[master cae629b] First commit
 1 file changed, 72 insertions(+)
  create mode 100644 max31856.py
  pi@raspberrypi:~/git/max31856 $ git push
  Username for 'https://github.com': garameki
  Password for 'https://garameki@github.com': **************************
  Counting objects: 3, done.
  Delta compression using up to 4 threads.
  Compressing objects: 100% (3/3), done.
  Writing objects: 100% (3/3), 1.26 KiB | 0 bytes/s, done.
  Total 3 (delta 0), reused 0 (delta 0)
  To https://github.com/garameki/max31856.git
     9f64c52..cae629b  master -&gt; master
$ <span class="spanCaution">echo</span> <span style="color:skyblue;">github.com/garamekiに行ってmax31856.pyがアップロードされているか確かめた</span>
</pre>
<br>
その後git pushができなくなった。<br>
<br>
<pre>
$ <span class="spanCaution">git push</span>
Username for 'https://github.com': garameki
Password for 'https://garameki@github.com': 
Counting objects: 3, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 919 bytes | 0 bytes/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
remote: error: GH007: Your push would publish a private email address.
remote: You can make your email public or disable this protection by visiting:
remote: http://github.com/settings/emails
To https://github.com/garameki/max31856.git
 ! [remote rejected] master -&gt; master (push declined due to email privacy restrictions)
 error: failed to push some refs to 'https://github.com/garameki/max31856.git'
</pre>
原因はGitHubのe-mail設定がPublicになっていないためらしい。<br><br>
<pre>
まず、エラーメッセージの<a href="https://git-scm.com/book/ja/v1/Git-%E3%81%AE%E5%9F%BA%E6%9C%AC-%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%9C%E6%A5%AD">URL</a>にアクセスする。<br>
次に「Block command line pushes that expose my email」のチェックを外す。
(「Keep my email address private」のチェックを外すとメールアドレスが公開されてしまうので、チェックははずさない。)<br>
</pre>
そしたらpushできるようになった。<br>
<br>
しかし、ユーザー名とパスワードをpushのたびに聞いてくる。<br>
<pre>
$ <span class="spanCaution">git push</span>
<span class="spanCaution">Username for 'https://github.com': garameki</span>
<span class="spanCaution">Password for 'https://garameki@github.com':</span>
Counting objects: 3, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 919 bytes | 0 bytes/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
To https://github.com/garameki/max31856.git
   cae629b..3b29514  master -&gt; master
</pre>
pushできるが、これでは面倒くさい。

<ul>
<li><a href="https://qiita.com/hash/items/5e4a6551b9f56f0af9dc">参考 GitHubにpushする度にusername/passwordを求められるとき</a>
<li><a href="https://git-scm.com/book/ja/v1/Git-%E3%81%AE%E5%9F%BA%E6%9C%AC-%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%81%A7%E3%81%AE%E4%BD%9C%E6%A5%AD">参考 Git-Remote</a>
</ul>
上記を参考に、originを書き換える
<pre>
$ <span class="spanCaution">git remote -v</span>
origin	https://github.com/garameki/max31856.git (fetch)
origin	https://github.com/garameki/max31856.git (push)
$ <span class="spanCaution">git remote rm origin</span>
$ <span class="spanCaution">git remote -v</span>
$ <span class="spanCaution">git remote add origin git@github.com:garameki/max31856.git</span>
$ <span class="spanCaution">git remote -v</span>
origin	git@github.com:garameki/max31856.git (fetch)
origin	git@github.com:garameki/max31856.git (push)
</pre>
次に、GitHubのアカウントのSSHに新しく作ったPublic Keyを入れる。
<pre>
$ <span class="spanCaution">ssh-keygen</span>
Generating public/private rsa key pair.
Enter file in which to save the key (/home/pi/.ssh/id_rsa): 
/home/pi/.ssh/id_rsa already exists.
Overwrite (y/n)? y
Enter passphrase (empty for no passphrase): 
Enter same passphrase again: 
Your identification has been saved in /home/pi/.ssh/id_rsa.
Your public key has been saved in /home/pi/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:F08O/lAqENw/gIER+N5XNXyBwQUruVvFCjJkEFMayi8 pi@raspberrypi
The key's randomart image is:
+---[RSA 2048]----+
|   .o=BB+  oo=o. |
|  ....oBo  .*o.  |
|   .o o oo*.+oo  |
|    .. . ++% o   |
|   .E.. S.*.=    |
|    ... .o =     |
|       .  . .    |
|                 |
|                 |
+----[SHA256]-----+
$ <span class="spanCaution">chmod 444 ~/.ssh/id_rsa.pub</span>
$ <span class="spanCaution">chmod 400 ~/.ssh/id_rsa</span>
$ <span class="spanCaution">ls -l ~/.ssh</span>
合計 20
-r--r--r-- 1 pi pi  396 11月  6 19:23 id_rsa.pub
-r-------- 1 pi pi 1766 11月  6 19:23 id_rsa
-rw-r--r-- 1 pi pi 1326 11月  6 19:01 known_hosts
</pre>
gitのmax31856ディレクトリに入って、pushする
<pre>
$ <span class="spanCaution">cd ~/git/max31856</span>
$ <span class="spanCaution">git push --set-upstream origin master</span>
Enter passphrase for key '/home/pi/.ssh/id_rsa': 
Counting objects: 3, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 280 bytes | 0 bytes/s, done.
Total 3 (delta 2), reused 0 (delta 0)
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
To github.com:garameki/max31856.git
   3d1bc62..05377a3  master -&gt; master
   Branch master set up to track remote branch master from origin.
</pre>
<br>
できた。<br>
<br>
<br>
ssh-keygenですでに存在しているkeyを上書きできないときは、パーミッションのwを有効にしてから行う。<br>
<br>
<br>
いままでGitを使っていたノートもsshを変えておかないと。。。

</div>

<h1>Windowsのメモ帳で編集したファイルのgit pushについて</h1>
<div class="pp">
<span class="spanExplain">参考サイト</span>
<ul>
<li><a href="https://qiita.com/yokoh9/items/1ec8099696ade0c1f36e">qiita : windows環境の git で改行コードの自動変換に注意</a>
<li><a href="https://help.github.com/articles/dealing-with-line-endings/#platform-windows">GitHub help : Dealing with line endings</a>
<li><a href="https://qiita.com/akmiyoshi/items/cae34407849cb8c2da1a">カレントディレクトリ以下で改行コードがCR+LFのファイルを探す</a>
<li><a href="https://eng-entrance.com/linux-shellscript-replacement">シェルスクリプトによる置換や削除</a>
<li><a href=""></a>
<li><a href=""></a>

</ul>
<h2>git push時にLFをCRLFにする機能をOFFにする</h2>
<div class="pp">
Linuxユーザーは使わないのでOFFにしておく。cloneするLinuxユーザーのためにもoffにしておく。
<pre>
$ <span class="spanCaution">git config --global core.autoCRLF false</span>
</pre>
</div>
<h2>メモ帳の保存時にUTF-8を指定する</h2>
<h2>ファイルからCRを削除しておく</h2>
<div class="pp">
<span class="spanExplain">参考リンク</span>
<ul>
<li><a href="https://eng-entrance.com/linux-shellscript-replacement">シェルスクリプトによる置換や削除</a>
<li><a href="https://qiita.com/akmiyoshi/items/cae34407849cb8c2da1a">カレントディレクトリ以下で改行コードがCR+LFのファイルを探す</a>
</ul>
<span class="spanExplain" style="text-decoration:line-through">CRを削除してもとのファイルを書き換えるコマンド</span>
<span class="spanExplain" style="color:yellow;">危険なコマンドです</span>
<pre>
$ <span class="spanCaution">sed -e 's/\r//g' * -i</span>
</pre>
<span class="spanExplain">CRLFが存在するファイル名を表示するコマンド</span>
<pre>
$ <span class="spanCaution">find . -type f | xargs grep -lzUP '\r\n'</span>
</pre>
<span class="spanExplain">実行結果</span>
<pre>
$ <span class="spanCaution">find . -type f | xargs grep -lzUP '\r\n'</span>
./.git/objects/1c/c66e9a7d2967d0245c240ae63fbd84b4c39802
./.git/objects/5d/a94d7bc07f8fbdfa32d823dd71ae65edd5276f
./.git/objects/9e/b8a39270104e9269ed8cacc25927b617d74b97
./.git/objects/e4/11670e80d7e71224413b46edae0061329ddf44
./git.html
./led7seg42.html
./led7seg4_1.jpg
./led7seg4_2.jpg
./LICENSE
./README.md
./style.css
./style_fukidashi.css
./template.html
./test2.txt

$ <span class="spanCaution">sed -e 's/\r//g' * -i</span>

$ <span class="spanCaution">find . -type f | xargs grep -lzUP '\r\n'</span>
./.git/objects/1c/c66e9a7d2967d0245c240ae63fbd84b4c39802
./.git/objects/5d/a94d7bc07f8fbdfa32d823dd71ae65edd5276f
./.git/objects/9e/b8a39270104e9269ed8cacc25927b617d74b97
./.git/objects/e4/11670e80d7e71224413b46edae0061329ddf44
</pre>
確かにCRLFがなくなっている。<br>
<span style="color:magenta;font-size:25px;">あれ！？JPGファイルまで変更されている！！！！</span><br>
<span class="spanExplain">こんな感じ</span>
<img src="git_1.jpg"><br>
<span class="spanExplain">(なぜか)リモートリポジトリから取り戻した</span>
<pre>
$ <span class="spanCaution">rm led7seg4_*.jpg</span>

$ <span class="spanCaution">git status</span>
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add/rm &lt;file&gt;..." to update what will be committed)
  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)

        modified:   LICENSE
        modified:   README.md
        modified:   git.html
        modified:   led7seg42.html
        deleted:    led7seg4_1.jpg
        deleted:    led7seg4_2.jpg
        deleted:    led7seg4_3.jpg
        modified:   style.css
        modified:   style_fukidashi.css
        modified:   template.html
        modified:   test2.txt

no changes added to commit (use "git add" and/or "git commit -a")

$ <span class="spanCaution">git add LICENSE README.md git.html led7seg42.html style.css style_fukidashi.css template.html test2.txt</span>

$ <span class="spanCaution">git commit -m "After removing CRLF"</span>
[master e457cfa] After removing CRLF
 2 files changed, 288 insertions(+), 250 deletions(-)

$ <span class="spanCaution">git push</span>
Enter passphrase for key '/c/Users/usaku/.ssh/id_rsa':
Counting objects: 4, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (4/4), done.
Writing objects: 100% (4/4), 2.43 KiB | 1.21 MiB/s, done.
Total 4 (delta 3), reused 0 (delta 0)
remote: Resolving deltas: 100% (3/3), completed with 3 local objects.
To github.com:garameki/raspberrypi_articles.git
   86abddb..e457cfa  master -&gt; master

$ <span class="spanCaution">git pull</span>
Enter passphrase for key '/c/Users/usaku/.ssh/id_rsa':
Already up to date.

$ <span class="spanCaution">git status</span>
On branch master
Your branch is up to date with 'origin/master'.

Changes not staged for commit:
  (use "git add/rm &lt;file&gt;..." to update what will be committed)
  (use "git checkout -- &lt;file&gt;..." to discard changes in working directory)

        deleted:    led7seg4_1.jpg
        deleted:    led7seg4_2.jpg
        deleted:    led7seg4_3.jpg

no changes added to commit (use "git add" and/or "git commit -a")

$ <span class="spanCaution">git checkout -- led7seg4_*.jpg</span>

$ <span class="spanCaution">git status</span>
On branch master
Your branch is up to date with 'origin/master'.

nothing to commit, working tree clean

$ <span class="spanCaution">git pull</span>
Enter passphrase for key '/c/Users/usaku/.ssh/id_rsa':
Already up to date.

$ <span class="spanCaution">ls</span>
total 374
drwxr-xr-x 1 usaku 197121      0 11月 22 15:54 .git
drwxr-xr-x 1 usaku 197121      0 11月 22 15:54 .
-rw-r--r-- 1 usaku 197121 110625 11月 22 15:54 led7seg4_1.jpg
-rw-r--r-- 1 usaku 197121 101030 11月 22 15:54 led7seg4_2.jpg
-rw-r--r-- 1 usaku 197121  95071 11月 22 15:54 led7seg4_3.jpg
-rw-r--r-- 1 usaku 197121  12152 11月 22 15:49 git.html
-rw-r--r-- 1 usaku 197121    149 11月 22 15:35 test2.txt
-rw-r--r-- 1 usaku 197121   1343 11月 22 15:35 template.html
-rw-r--r-- 1 usaku 197121    942 11月 22 15:35 style.css
-rw-r--r-- 1 usaku 197121   3744 11月 22 15:35 style_fukidashi.css
-rw-r--r-- 1 usaku 197121     57 11月 22 15:35 README.md
-rw-r--r-- 1 usaku 197121   1830 11月 22 15:35 script.js
-rw-r--r-- 1 usaku 197121   1065 11月 22 15:35 LICENSE
-rw-r--r-- 1 usaku 197121   1124 11月 22 15:35 led7seg42.html
-rw-r--r-- 1 usaku 197121   9686 11月 22 15:35 led7seg4.html
</pre>
<span class="spanExplain">ターゲットを絞ってCRLFを消す！</span>
<pre>
$ <span class="spanCaution">sed -e 's/\r//g' *.html -i</span>
</pre>
</div>

</div>
<br><hr><div style="text-align:right;"><a href="http://raspberrypi.garameki.com#20181106">がらめきドットコム</a><br>Powered by RaspberryPi3B+ Raspbian stretch</div></body></html>
<img right="GitHub ,inc." src="OCTOCAT.jpg">
