<html lang='ja'><head><meta charset="utf-8"><meta http-equiv="Content-Style-Type" content="text/css"><link rel="stylesheet" type="text/css" href="style.css" /><link rel="stylesheet" type="text/css" href="style_fukidashi.css" />
<script type="application/javascript" src="script.js"></script>
<meta name="description" content="任意の文字列を声にしてクライアントに配信してみる">
<title>任意の声を配信する|がらめきドットコム</title>
</head><body id="body">
<h1>入力欄に入れた文字を声にして、クライアントに配信してみる</h1>
<div class="pp">
websocketサーバーにいくつかのクライアントがkeep-aliveしている。<br>
そのうちの１つのクライアントは、入力した文字を音声に変えて他のクライアントにソケットサーバーを通して配信する。
<span class="spanExplain">参考にしたサイト</span>
<ul>
<li><a href="http://maku77.github.io/python/env/call-external-program.html">天才まくまくノート　Python から外部プログラムを起動する (subprocess.run)　</a>
<li><a href="https://qiita.com/wanwanland/items/ce272419dde2f95cdabc">Pythonでの正規表現の使い方</a>
<li><a href="https://developer.mozilla.org/ja/docs/Web/API/AudioContext/createBufferSource">MDN AudioContext.createBufferSource()</a>
<li><a href="https://qiita.com/tkdn/items/ea4f034e0d661def244a"></a>
<li><a href="https://qiita.com/tkdn/items/ea4f034e0d661def244a#%E3%82%AC%E3%83%99%E3%83%BC%E3%82%B8%E3%82%B3%E3%83%AC%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3">JavaScript の仕組み：メモリ管理+ 4つの共通のメモリリーク処理方法</a>
</ul>
</div>

<h2>改造点</h2>
<div class="pp">
<span class="spanExplain">websocket-client-voice-send-6601.py</span>
<pre>
...
import subprocess
...
def on_message(ws, message):
	objSentence = re.search("^SAY(.*)$",message)
	print(objSentence.group(1))
	if objSentence.group(1) is not "":
		try:
			result = subprocess.run('aquestalkpi/AquesTalkPi "　　　{}"'.format(objSentence.group(1)),shell=True,check=True,stdout=subprocess.PIPE, stderr=subprocess.PIPE, universal_newlines=False)
			data2 = base64.b64encode(result.stdout)
			ws.send(data2)#correct
		except :
			print("AquesTalkPi ERROR")
...
</pre>
subprocessによって生成されたwavファイルをBase64にエンコードしてwebsocketサーバーに渡している
</div>
<br><br>
<br><hr><div style="text-align:right;"><a href="http://raspberrypi.garameki.com#">がらめきドットコム</a><br>Powered by RaspberryPi3B+ Raspbian stretch</div></body></html>
